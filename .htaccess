# Security Protection for Bypasserv3
# Block malicious files and exploits

# Enable RewriteEngine
RewriteEngine On

# Block suspicious files by name
<FilesMatch "(monarx|c99|r57|wso|shell|backdoor|eval|hack|exploit|malware)">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Prevent direct access to config files
<FilesMatch "^(config|functions)\.php$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Block common exploit attempts in URLs
RewriteCond %{QUERY_STRING} (<|%3C).*script.*(>|%3E) [NC,OR]
RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} (eval|base64_decode|system|exec|passthru)\( [NC,OR]
RewriteCond %{QUERY_STRING} \.\./\.\. [NC]
RewriteRule ^(.*)$ - [F,L]

# Disable directory listing
Options -Indexes

# Protect .git folder if exists
RedirectMatch 404 /\.git

# Protect composer files
<FilesMatch "^(composer\.json|composer\.lock|package\.json)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>
