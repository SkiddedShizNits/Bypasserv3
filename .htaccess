# Bypasserv3 - Main Security Rules

# Enable URL Rewriting
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Block access to sensitive files
    RewriteRule ^config\.php$ - [F,L]
    RewriteRule ^functions\.php$ - [F,L]
    RewriteRule ^composer\.(json|lock)$ - [F,L]
    RewriteRule ^\.env$ - [F,L]
    RewriteRule ^\.git - [F,L]
</IfModule>

# Disable directory listing
Options -Indexes

# Protect sensitive files
<FilesMatch "^\.">
    Order Allow,Deny
    Deny from all
</FilesMatch>

<FilesMatch "(^#.*#|\.(bak|conf|dist|fla|in[ci]|log|psd|sh|sql|sw[op])|~)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    Header unset X-Powered-By
</IfModule>

# Disable PHP execution in data directory
<Directory "data">
    php_flag engine off
    Options -ExecCGI
    RemoveHandler .php .phtml .php3 .php4 .php5 .phps
    RemoveType .php .phtml .php3 .php4 .php5 .phps
</Directory>

# Prevent access to backup files
<FilesMatch "\.(bak|backup|old|save|swp)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Block bad bots
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTP_USER_AGENT} (libwww-perl|wget|python-requests|curl|PHPCrawl|Java) [NC,OR]
    RewriteCond %{HTTP_USER_AGENT} (Scrapy|Mechanize|HTTrack|WebCopier|Teleport) [NC]
    RewriteRule .* - [F,L]
</IfModule>
